import React from "react";
import {
  render,
  screen,
  fireEvent,
  cleanup,
  waitForElement,
  findByText,
} from "@testing-library/react";
import "@testing-library/jest-dom/extend-expect";
import userEvent from "@testing-library/user-event";
import { Router } from "react-router-dom";
import { createMemoryHistory } from "history";
import { ApolloProvider } from "@apollo/client";

import App from "./App";
import InputProvider from "./contexts/inputField";
import { client } from "./apollo";

afterEach(cleanup);

test("Whole app test; one", async () => {
  const history = createMemoryHistory();
  render(
    <Router history={history}>
      <InputProvider>
        <ApolloProvider client={client}>
          <App />
        </ApolloProvider>
      </InputProvider>
    </Router>
  );

  userEvent.type(screen.getByTestId("my-input"), "manou-codeur");
  userEvent.click(screen.getByTestId("search-icon"));

  expect(screen.getAllByRole("progressbar")[0]).toBeInTheDocument();

  expect(await screen.findByTestId("my-name")).toBeInTheDocument();
});
